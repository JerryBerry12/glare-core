<?xml version="1.0" encoding="utf-8" ?>
<scenedata>

	<metadata>
		<note>
			This material is a weird one.
			The blend material blend factor is based on normalWS().
			This determines the initial blend, for the purposes of computing the shading normal,
			then the bump maps from the two children are blended together, determining the final shading normal.

			For evaluating the BSDF, the final shading normal is used, resulting in a different blend factor at the same position!

			This material is based on the Snowy Rock material: https://www.indigorenderer.com/materials/materials/1132
		</note>
	</metadata>
	
    <material>
        <uid>30</uid>
        <name>rock</name>
        <phong>
            <diffuse_albedo>
							<constant>
								<rgb>
									<rgb>0.8 0 0</rgb>
									<gamma>2.2</gamma>
								</rgb>
							</constant>
            </diffuse_albedo>
					
            <exponent>
                <constant>50</constant>
            </exponent>
					
            <bump>
							<texture>
								<path>../../testscenes/indigo.jpg</path>
								<a>0</a>
								<b>0.002</b>
								<c>0</c>
								<uv_set_index>0</uv_set_index>
								<exponent>1</exponent>
							</texture>
            </bump>
            <ior>1.35</ior>
        </phong>
    </material>
	
    <material>
        <uid>31</uid>
        <name>snow</name>
        <phong>
            <diffuse_albedo>
                <constant>
                    <rgb>
                        <rgb>0.8 0.8 0.8</rgb>
                        <gamma>2.2</gamma>
                    </rgb>
                </constant>
            </diffuse_albedo>
					
            <exponent>
                <constant>10</constant>
            </exponent>
					
            <bump>
								<texture>
									<path>../../testscenes/spherebump.jpg</path>
									<a>0</a>
									<b>0.002</b>
									<c>0</c>
									<uv_set_index>0</uv_set_index>
									<exponent>1</exponent>
								</texture>
            </bump>
            <ior>1.2</ior>
        </phong>
    </material>
	
    <material>
        <uid>8</uid>
        <name>snowy rock</name>
        <blend>
            <a_name>rock</a_name>
            <b_name>snow</b_name>
            <blend>
                <shader>
                    <shader>
                        <![CDATA[def eval() real :
													if(normalWS().z > 0.6, 1.0, 0.0)
												]]>
									</shader>
                </shader>
            </blend>
            <step_blend>false</step_blend>
        </blend>
    </material>
</scenedata>
